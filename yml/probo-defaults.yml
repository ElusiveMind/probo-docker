# App name
name: amour
# Port for the server to listen on
port: 3010
# The host time bind to.
host: '0.0.0.0'
hostname: localhost
# Can be any { socketPath: '/path' } or { host: 'somehost', port: 9999 }
# See dockerode constructor for details: https://github.com/apocas/dockerode
docker:
  socketPath: '/var/run/docker.sock'
# name of the instance used in status updates
instanceName: '$CM_INSTANCE_NAME'
# prefix to use for container names
containerNamePrefix: "probo"
# container capacity of this container manager instance
containerCapacity: -1  # -1 is unlimited or not set
#proxyStartupPause: 2s   # Amount of time to pause after a proxy request starts a container

# If a container proxy lookup needs to start a non-running (but existing)
# container, it'll automatically stop the container after this timeout
# However, every time the proxy's lookup cache expires and it sends another
# proxy lookup request to the Container Manager, that container's idle timeout
# is reset again to this timeout value
containerIdleTimeout: 30m # can use time units here. no units = ms

# Prefixes all routes so that the app can be namespaced.
prefix: ''
# If a cotnainer is not specified in the repository's configuration, use this one.
defaultImage: 'proboci/ubuntu-14.04-lamp'
# The default image used if none is specified.
image: 'proboci/ubuntu-14.04-lamp'
# The images used by the host manager
images:
  'mbagnall/ubuntu-14.04':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      postgresql:
        command: 'sudo -u postgres /usr/lib/postgresql/9.3/bin/postgres -D /var/lib/postgresql/9.3/main --config_file=/etc/postgresql/9.3/main/postgresql.conf'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'mbagnall/ubuntu-14.04:php5.5':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      postgresql:
        command: 'sudo -u postgres /usr/lib/postgresql/9.3/bin/postgres -D /var/lib/postgresql/9.3/main --config_file=/etc/postgresql/9.3/main/postgresql.conf'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'mbagnall/ubuntu-14.04:php5.6':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      postgresql:
        command: 'sudo -u postgres /usr/lib/postgresql/9.3/bin/postgres -D /var/lib/postgresql/9.3/main --config_file=/etc/postgresql/9.3/main/postgresql.conf'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'mbagnall/ubuntu-14.04:php7.0':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      postgresql:
        command: 'sudo -u postgres /usr/lib/postgresql/9.3/bin/postgres -D /var/lib/postgresql/9.3/main --config_file=/etc/postgresql/9.3/main/postgresql.conf'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'mbagnall/ubuntu-14.04:php7.1':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      postgresql:
        command: 'sudo -u postgres /usr/lib/postgresql/9.3/bin/postgres -D /var/lib/postgresql/9.3/main --config_file=/etc/postgresql/9.3/main/postgresql.conf'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'mbagnall/ubuntu-14.04:php7.2':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      postgresql:
        command: 'sudo -u postgres /usr/lib/postgresql/9.3/bin/postgres -D /var/lib/postgresql/9.3/main --config_file=/etc/postgresql/9.3/main/postgresql.conf'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'mbagnall/ubuntu-16.04':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      postgresql:
        command: 'sudo -u postgres /usr/lib/postgresql/9.5/bin/postgres -D /var/lib/postgresql/9.5/main --config_file=/etc/postgresql/9.5/main/postgresql.conf'
      mailcatcher:
        command: 'mailcatcher'
        port: 1080
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'mbagnall/ubuntu-16.04:php7.1':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'service mysql start'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      postgresql:
        command: 'sudo -u postgres /usr/lib/postgresql/9.5/bin/postgres -D /var/lib/postgresql/9.5/main --config_file=/etc/postgresql/9.5/main/postgresql.conf'
      mailcatcher:
        command: 'mailcatcher --ip 0.0.0.0'
        port: 1080
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'mbagnall/ubuntu-16.04:php7.2':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      postgresql:
        command: 'sudo -u postgres /usr/lib/postgresql/9.5/bin/postgres -D /var/lib/postgresql/9.5/main --config_file=/etc/postgresql/9.5/main/postgresql.conf'
      mailcatcher:
        command: 'mailcatcher'
        port: 1080
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-14.04-lamp':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-14.04-lamp:php-5.6-beta':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-14.04-lamp:php-7.0-beta':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-14.04-lamp:php-7.1-beta':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-14.04-lamp:php-5.6':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-14.04-lamp:php-7.0':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-14.04-lamp:php-7.1':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-14.04-lamp:latest':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-16.04-lamp:php-7.0-beta':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-16.04-lamp:php-7.1-beta':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-16.04-lamp:php-7.2-beta':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-16.04-lamp:php-7.0':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-16.04-lamp:php-7.1':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
  'proboci/ubuntu-16.04-lamp:php-7.2':
    services:
      cleanapache:
        command: 'rm /var/run/apache2/apache2.pid'
      apache:
        command: '/usr/sbin/apache2ctl -D FOREGROUND'
        port: 80
      mysql:
        command: 'mysqld_safe'
      redis:
        command: 'redis-server'
      solr:
        command: 'service solr start'
      php_log:
        command: 'tail -F /var/log/php/error.log'
dataDir: './container-manager-data'
# Volumes to mount into created containers.
binds: []
# Settings for the github handler
# port
githubWebhookPath: '/github-webhook'
githubWebhookSecret: 'CHANGE-ME'
# This is temporary, we will need a proper oauth system to get the tokens that should be used.
githubAPIToken: 'personal token here'

# Settings for the API or Container Manager server
# port
api:
  url: "http://localhost:3000"
  token: "API token here"

# loom (log aggregator server)
loom:
  url: "http://localhost:3060"
  token: $PROBO_LOOM_SERVER_TOKEN

# asset server (must NOT be localhost because it's called from within container)
assets:
  url: '$ASSET_RECEIVER_URL'
  token: $PROBO_ASSET_RECEIVER_TOKEN

# auth credentials service (i.e., for stash)
auth:
  url: "http://localhost:3012/auth_lookup"

buildsEventStream:
  plugin: 'Kafka'
  config:
    version: 1
    topic: build_events
    group: probo
    # see https://github.com/SOHU-Co/kafka-node#clientconnectionstring-clientid-zkoptions-noackbatchoptions
    # for available options
    kafkaClientOptions:
      connectionString: 'zookeeper:2181'


